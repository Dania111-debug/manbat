<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù…Ù†Ø¨Øª | Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø¯Ø§Ø±Ø³</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css"/>

<style>
body {
    margin:0;
    font-family: Arial;
    display:flex;
    background:#0f172a;
    color:#e5e7eb;
}
#side {
    width:300px;
    background:#1e293b;
    padding:15px;
}
h2 { color:#34d399 }
input,button {
    width:100%;
    padding:8px;
    margin:6px 0;
    border-radius:8px;
    border:none;
}
button {
    background:#34d399;
    cursor:pointer;
}
#map {
    flex:1;
}
li { margin:4px 0 }
</style>
</head>

<body>

<div id="side">
<h2>ğŸŒ± Ù…Ù†Ø¨Øª</h2>

<input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©">
<button onclick="add()">Ø¥Ø¶Ø§ÙØ©</button>

<p>ğŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†: <span id="count">0</span></p>

<h3>ğŸ† Top 5</h3>
<ul id="top"></ul>
</div>

<div id="map"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
<script>
let map = L.map('map').setView([24.7,46.6],6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

let markerPos=null;

map.on('click',e=>{
    markerPos=e.latlng;
    L.marker(e.latlng).addTo(map);
});

async function add(){
    if(!markerPos) return alert("Ø§Ø®ØªØ§Ø±ÙŠ Ù…ÙˆÙ‚Ø¹");
    let name=document.getElementById("name").value;
    if(!name) return alert("Ø§ÙƒØªØ¨ÙŠ Ø§Ù„Ø§Ø³Ù…");

    await fetch("/add",{
        method:"POST",
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({name,lat:markerPos.lat,lng:markerPos.lng})
    });

    load();
}

async function load(){
    document.getElementById("count").innerText =
      await (await fetch("/count")).json();

    let top = await (await fetch("/top")).json();
    let ul=document.getElementById("top");
    ul.innerHTML="";
    top.forEach(t=>{
        ul.innerHTML+=`<li>${t[0]} (${t[1]})</li>`;
    });
}

load();
</script>

</body>
</html>
