<script type="module">

// Firebase SDK
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyAkDXP7hCcgdQ_PtInKHAsVvXzwOLW1J6I",
  authDomain: "manbat-b0919.firebaseapp.com",
  projectId: "manbat-b0919",
  storageBucket: "manbat-b0919.firebasestorage.app",
  messagingSenderId: "286518930930",
  appId: "1:286518930930:web:69cc91accf5ba121864f6b"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// عند الضغط على الخريطة
let selectedLat = null;
let selectedLng = null;

map.on('click', function(e) {
  selectedLat = e.latlng.lat;
  selectedLng = e.latlng.lng;

  L.marker([selectedLat, selectedLng]).addTo(map);
});

// دالة الإرسال
window.submit = async function () {

  const name = document.getElementById("name").value;
  const students = document.getElementById("students").value;

  if (!name || !students || selectedLat === null) {
    alert("املئي كل البيانات واختاري موقع من الخريطة");
    return;
  }

  try {
    await addDoc(collection(db, "schools"), {
      name: name,
      students: students,
      lat: selectedLat,
      lng: selectedLng
    });

    alert("تم حفظ المدرسة بنجاح ✅");

    document.getElementById("name").value = "";
    document.getElementById("students").value = "";

  } catch (error) {
    console.error("Error adding document: ", error);
    alert("حدث خطأ ❌");
  }
};

// تحميل الدبابيس عند فتح الصفحة
async function loadSchools() {

  const querySnapshot = await getDocs(collection(db, "schools"));

  querySnapshot.forEach((doc) => {
    const data = doc.data();

    L.marker([data.lat, data.lng])
      .addTo(map)
      .bindPopup(`${data.name} - ${data.students} طالب`);
  });
}

loadSchools();

</script>
