<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>ุฎุฑูุทุฉ ูุฏุงุฑุณ ููุจุช</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

    <style>
        #map {
            height: 500px;
            width: 100%;
        }
    </style>
</head>

<body>

<h1>๐บ๏ธ ุฎุฑูุทุฉ ูุฏุงุฑุณ ููุจุช</h1>

<h3 id="counter">ุนุฏุฏ ุงููุฏุงุฑุณ ุงููุดุงุฑูุฉ: ...</h3>

<p>ุงุถุบุทู ุนูู ุงูุฎุฑูุทุฉ ูุชุญุฏูุฏ ุงููููุน ุซู ุงูุชุจู ุงุณู ุงููุฏุฑุณุฉ</p>

<input id="schoolName" type="text" placeholder="ุงุณู ุงููุฏุฑุณุฉ">

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>

var map = L.map('map').setView([24.7136, 46.6753], 6);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

// ุชุญููู ุงููุฏุงุฑุณ
fetch('/schools')
.then(res => res.json())
.then(data => {
    data.forEach(s => {
        L.marker([s.lat, s.lng])
            .addTo(map)
            .bindPopup(s.name);
    });
});

// ุชุญููู ุนุฏุฏ ุงููุฏุงุฑุณ
fetch('/schools/count')
.then(res => res.json())
.then(data => {
    document.getElementById('counter').innerText =
        "ุนุฏุฏ ุงููุฏุงุฑุณ ุงููุดุงุฑูุฉ: " + data.count;
});

let selectedLocation = null;

// ุชุญุฏูุฏ ุงููููุน
map.on('click', function(e) {
    selectedLocation = e.latlng;
    alert("ุชู ุชุญุฏูุฏ ุงููููุนุ ุงูุขู ุงูุชุจู ุงุณู ุงููุฏุฑุณุฉ");
});

// ุฅุถุงูุฉ ูุฏุฑุณุฉ
document.getElementById("schoolName").addEventListener("change", function() {

    if (!selectedLocation) {
        alert("ุญุฏุฏู ุงููููุน ุฃููุงู");
        return;
    }

    let name = this.value.trim();
    if (!name) return;

    fetch('/add_school', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            name: name,
            lat: selectedLocation.lat,
            lng: selectedLocation.lng
        })
    })
    .then(res => res.json())
    .then(data => {
        alert(data.message || data.error);
        location.reload();
    });
});

</script>

</body>
</html>
