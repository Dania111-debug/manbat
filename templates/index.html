<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ø®Ø±ÙŠØ·Ø© Ù…Ø¯Ø§Ø±Ø³ Ù…Ù†Ø¨Øª</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        #map {
            height: 500px;
            width: 100%;
            border-radius: 10px;
        }

        input {
            padding: 8px;
            width: 260px;
            font-size: 14px;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>

<h2>ğŸ—ºï¸ Ø®Ø±ÙŠØ·Ø© Ù…Ø¯Ø§Ø±Ø³ Ù…Ù†Ø¨Øª</h2>
<p>Ø­Ø¯Ø¯ÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø«Ù… Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</p>

<input
    id="schoolName"
    type="text"
    placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©"
/>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    var map = L.map('map').setView([24.7136, 46.6753], 6);

    // Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
    fetch('/schools')
        .then(response => response.json())
        .then(data => {
            data.forEach(school => {
                L.marker([school.lat, school.lng])
                    .addTo(map)
                    .bindPopup(school.name);
            });
        });

    let selectedLocation = null;

    // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    map.on('click', function(e) {
        selectedLocation = e.latlng;
        alert("ğŸ“ ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŒ Ø§Ù„Ø¢Ù† Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©");
    });

    // Ø¹Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©
    document.getElementById("schoolName").addEventListener("change", function() {
        if (!selectedLocation) {
            alert("â— Ø­Ø¯Ø¯ÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£ÙˆÙ„Ø§Ù‹");
            return;
        }

        let schoolName = this.value.trim();
        if (!schoolName) return;

        fetch('/add_school', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                name: schoolName,
                lat: selectedLocation.lat,
                lng: selectedLocation.lng
            })
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message || data.error);
            location.reload();
        });
    });
</script>

</body>
</html>
